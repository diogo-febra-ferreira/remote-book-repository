<!DOCTYPE html>
<html>

<head>
    <title>Booklist</title>
</head>

<body>

    <h1>Booklist</h1>
    <p>Booklist</p>

    <form id="upload-form" enctype="multipart/form-data" style="background-color:blanchedalmond;">
        <input type="file" name="file" required>
        <button type="submit">Upload</button>
    </form>

    <a href="/">Home</a>
    <br><br>

    <div id="bookLinksContainer" style="background-color:aquamarine;"></div>
</body>

</html>


<script>

    const baseUrl = window.location.origin;

    function addUploadOnClick() {
        document.getElementById('upload-form').addEventListener('submit', function (event) {
            event.preventDefault();

            const formData = new FormData(this);
            fetch('/books/upload', {
                method: 'POST',
                body: formData
            })
                .then(response => response.text())
                .then(data => {
                    alert(data);
                    setTimeout(() => {
                        getBookList();
                    }, 1000);
                })
                .catch(error => console.error('Error:', error));
        })
    }
    addUploadOnClick();

    function getBookList() {
        const apiPath = baseUrl + "/books/info";

        fetch(apiPath)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                const linksContainer = document.getElementById("bookLinksContainer");
                linksContainer.innerHTML = "";

                data.forEach(book => {
                    const link = document.createElement("a");
                    link.href = '/books/name/' + book;
                    link.textContent = book;
                    linksContainer.appendChild(link);
                    linksContainer.appendChild(document.createElement("br"));
                });
            })
            .catch(error => {
                console.error('There has been a problem with your fetch operation:', error);
            });
    }
    getBookList();

</script>